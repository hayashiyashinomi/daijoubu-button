<div class="min-h-screen grid place-items-center px-4">
  <div class="w-full max-w-md text-center">
    <h1 class="text-4xl font-bold tracking-tight mb-6">大丈夫ボタン</h1>

    <!-- メッセージ表示：固定幅・固定高でズレ防止 -->
    <p id="message"
       class="mx-auto mb-8 text-2xl font-semibold leading-relaxed w-full min-h-[2.5rem]">
      ボタンを押すと「大丈夫」が表示されます
    </p>

    <div class="flex items-center justify-center gap-3">
      <!-- 固定幅でズレ防止 -->
      <button id="ok-button"
        class="w-72 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg shadow transition">
        大丈夫ボタンを押す
      </button>

      <button id="copy-button"
        class="w-40 px-4 py-3 bg-zinc-700 hover:bg-zinc-800 text-white rounded-md transition">
        コピー
      </button>
    </div>

    <!-- コピー通知トースト：初期は非表示 -->
    <div id="copy-toast"
         class="mt-4 text-sm opacity-0 pointer-events-none transition-opacity duration-200">
      コピーしました
    </div>
  </div>
</div>

<script>
document.addEventListener('turbo:load', () => {
  const messages = [
    "大丈夫",
    "Everything will be okay",
    "Está todo bien",
    "Ça va aller",
    "괜찮아",
    "Все будет хорошо",
    "Tudo bem",
    "จะไม่เป็นไร",
    "Tudo vai dar certo"
  ];

  const msg = document.getElementById('message');
  const okBtn = document.getElementById('ok-button');
  const copyBtn = document.getElementById('copy-button');
  const toast = document.getElementById('copy-toast');

  // 文字色は body に合わせているので、特別なCSSは不要
  okBtn?.addEventListener('click', () => {
    const random = messages[Math.floor(Math.random() * messages.length)];
    msg.textContent = random;
  });

  let copyTimer = null;
  copyBtn?.addEventListener('click', async () => {
    // 連打ガード：一時的に無効化
    copyBtn.disabled = true;

    try {
      await navigator.clipboard.writeText(msg.textContent || "");
      // ラベル固定のまま、トーストだけ点灯
      toast.classList.remove('opacity-0');
      toast.classList.add('opacity-100');

      // 既存タイマーがあれば消す
      if (copyTimer) clearTimeout(copyTimer);
      copyTimer = setTimeout(() => {
        toast.classList.remove('opacity-100');
        toast.classList.add('opacity-0');
        copyTimer = null;
      }, 1000);
    } catch {
      alert("コピーに失敗しました");
    } finally {
      setTimeout(() => { copyBtn.disabled = false; }, 300);
    }
  });
});
</script>
