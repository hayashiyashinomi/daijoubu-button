<div class="min-h-screen flex items-center justify-center px-4">
  <div class="w-full max-w-md text-center">
    <!-- タイトル（中央固定） -->
    <h1 class="text-4xl font-bold tracking-tight mb-6">大丈夫ボタン</h1>

    <!-- メッセージ領域：高さ固定で“ぬるっ”とズレない -->
    <p id="message"
       class="text-2xl font-semibold mb-8 text-gray-900 dark:text-white"
       style="min-height: 2.5rem;">
      ボタンを押すと「大丈夫」が表示されます
    </p>

    <!-- ボタン縦並び（幅固定でブレ防止） -->
    <div class="flex flex-col items-center gap-3">
      <button id="ok-button"
              class="w-60 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg shadow">
        押す
      </button>

      <button id="copy-button"
              class="w-60 px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-md">
        コピー
      </button>
    </div>

    <!-- コピー結果表示（高さ固定でレイアウト揺れ防止） -->
    <p id="copy-status"
       class="mt-3 h-6 text-sm text-emerald-600 dark:text-emerald-400"
       aria-live="polite"></p>
  </div>
</div>

<script>
document.addEventListener('turbo:load', () => {
  const messages = <%= raw @messages.to_json %>; // YAMLから来た配列

  const msg     = document.getElementById('message');
  const okBtn   = document.getElementById('ok-button');
  const copyBtn = document.getElementById('copy-button');
  const status  = document.getElementById('copy-status');

  okBtn?.addEventListener('click', () => {
    const random = messages[Math.floor(Math.random() * messages.length)];
    msg.textContent = random;
  });

  // 連打対策：単一タイマーを管理して毎回クリア
  let copyTimerId = null;

  copyBtn?.addEventListener('click', async () => {
    const text = msg.textContent;
    try {
      await navigator.clipboard.writeText(text);

      if (copyTimerId) clearTimeout(copyTimerId);
      status.textContent = "コピーしました！";
      copyTimerId = setTimeout(() => {
        status.textContent = "";
        copyTimerId = null;
      }, 1200);
    } catch (e) {
      if (copyTimerId) clearTimeout(copyTimerId);
      status.textContent = "コピーに失敗しました";
      copyTimerId = setTimeout(() => {
        status.textContent = "";
        copyTimerId = null;
      }, 2000);
    }
  });
});
</script>
